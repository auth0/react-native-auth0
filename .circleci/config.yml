version: 2.1

orbs:
  ship: auth0/ship@0
  codecov: codecov/codecov@3

jobs:
  pre-publish:
    executor:
      name: ship/node
      tag: 18.16.0
    steps:
      - checkout
      - ship/node-install-packages:
          pkg-manager: yarn

workflows:
  publish:
    jobs:
      - pre-publish:
          filters:
            branches:
              only:
                - master

      - ship/node-publish:
          node-version: 18.16.0
          pkg-manager: yarn
          publish-command: npm publish
          requires:
            - pre-publish
          context:
            - publish-npm
            - publish-gh
          filters:
            branches:
              only:
                - master
